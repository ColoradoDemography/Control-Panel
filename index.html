<!DOCTYPE html>
<html>

<head>
    <title>Control Panel</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <style>
    
      html{
        padding: 20px;
      }
    
      button{
        padding: 5px;
        margin: 5px;
      }
    
    </style>
  
</head>
  
<body>
  <br />
  <h1>Demography Control Panel</h1>
  <button>Update Demography Website</button>
  <br /><br />
  <hr />
  <br />
  
  <!-- dynamically update this div with repos that are in Colorado Demography -->
  <h2>Update Project</h2>
  <br />
  <div id="dynamic"></div>
  
  
    <script>
      
      function jsRequest(path, callback){
        var xhr = new XMLHttpRequest();
        xhr.open('GET', path);
        xhr.send(null);
      
        xhr.onreadystatechange = function () {
          var DONE = 4; // readyState 4 means the request is done.
          var OK = 200; // status 200 is a successful return.
          if (xhr.readyState === DONE) {
            if (xhr.status === OK) {
              callback(JSON.parse(xhr.responseText));
            } else {
              console.log('Error: ' + xhr.status); // An error occurred during the request.
            }
          }
        };
      }
      
      jsRequest('https://api.github.com/users/ColoradoDemography/repos?', hasIndex);

            
      function hasIndex(data){
        console.log(data);
        
        data.forEach(function(d){
          console.log('d: ' + d);
          
          jsRequest('https://api.github.com/repos/ColoradoDemography/' + d.name + '/git/trees/master', function(e){
            
            e.tree.forEach(function(f){
              console.log('f: ' + f);
              
              if(f.path === 'index.html'){
                
                //lone exception to the 'display if has index.html' rule
                if(d.name !=== 'demographic_dashboard'){
                  
                  var dynamic = document.getElementById('dynamic');  
                  var el = document.createElement('button');
                  el.innerHTML = d.name;
                  dynamic.appendChild(el).insertAdjacentHTML('afterend', '</br>');
                  
                }
                
              }
              
            });
                        
          });
          
        });
             
      }

      
  </script>


</body>

</html>